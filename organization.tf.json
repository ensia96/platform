{
  "resource": {
    "oci_budget_alert_rule": {
      "main": {
        "budget_id": "${oci_budget_budget.main.id}",
        "recipients": "${var.email}",
        "threshold": 1,
        "threshold_type": "PERCENTAGE",
        "type": "FORECAST"
      }
    },
    "oci_budget_budget": {
      "main": {
        "amount": 1,
        "compartment_id": "${var.tenancy_ocid}",
        "reset_period": "MONTHLY"
      }
    },
    "oci_identity_compartment": {
      "platform": {
        "compartment_id": "${var.tenancy_ocid}",
        "description": "${local.project}",
        "name": "${local.project}"
      }
    },
    "oci_identity_group": {
      "managers": {
        "compartment_id": "${var.tenancy_ocid}",
        "description": "manage ${local.project}",
        "name": "${local.project}-identity-group-managers"
      }
    },
    "oci_identity_policy": {
      "cluster": {
        "compartment_id": "${var.tenancy_ocid}",
        "description": "manage resources",
        "name": "${local.project}-identity-policy-cluster",
        "statements": [
          "Allow service OKE to manage all-resources in compartment id ${oci_identity_compartment.platform.id}"
        ]
      },
      "manager": {
        "compartment_id": "${var.tenancy_ocid}",
        "description": "manage ${local.project}",
        "name": "${local.project}-identity-policy-manager",
        "statements": [
          "Allow group ${oci_identity_group.managers.name} to manage all-resources in tenancy"
        ]
      }
    },
    "oci_identity_user": {
      "manager": {
        "compartment_id": "${var.tenancy_ocid}",
        "description": "manage ${local.project}",
        "email": "${local.project}@terraform.com",
        "name": "${local.project}-identity-user-manager"
      }
    },
    "oci_identity_user_group_membership": {
      "manager": {
        "group_id": "${oci_identity_group.managers.id}",
        "user_id": "${oci_identity_user.manager.id}"
      }
    },
    "oci_logging_log": {
      "load-balancer-access": {
        "configuration": {
          "source": {
            "category": "access",
            "resource": "${oci_load_balancer_load_balancer.main.id}",
            "service": "loadbalancer",
            "source_type": "OCISERVICE"
          }
        },
        "display_name": "${local.project}-log-load-balancer-access",
        "log_group_id": "${oci_logging_log_group.main.id}",
        "log_type": "SERVICE",
        "retention_duration": "${local.log-retention-duration}"
      },
      "vcn": {
        "configuration": {
          "source": {
            "category": "all",
            "resource": "${oci_core_vcn.main.id}",
            "service": "flowlogs",
            "source_type": "OCISERVICE"
          }
        },
        "display_name": "${local.project}-log-vcn",
        "log_group_id": "${oci_logging_log_group.main.id}",
        "log_type": "SERVICE",
        "retention_duration": "${local.log-retention-duration}"
      }
    },
    "oci_logging_log_group": {
      "main": {
        "compartment_id": "${oci_identity_compartment.platform.id}",
        "display_name": "${local.project}-log-group-main"
      }
    },
    "tailscale_acl": {
      "main": { "acl": "${jsonencode(local.tailscale-acl)}" }
    },
    "tailscale_tailnet_key": {
      "main": {
        "ephemeral": true,
        "preauthorized": true,
        "reusable": true,
        "tags": ["${local.tailscale-acl-tag}"]
      }
    }
  }
}

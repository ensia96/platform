{
  "resource": {
    "helm_release": {
      "prometheus": {
        "chart": "kube-prometheus-stack",
        "name": "prometheus",
        "namespace": "${kubernetes_namespace.system.metadata.0.name}",
        "repository": "https://prometheus-community.github.io/helm-charts",
        "values": ["${jsonencode(local.prometheus-values)}"],
        "version": "68.2.1"
      },
      "traefik": {
        "chart": "traefik",
        "name": "traefik",
        "namespace": "${kubernetes_namespace_v1.system.metadata.0.name}",
        "repository": "https://traefik.github.io/charts",
        "set": [
          { "name": "deployment.replicas", "value": 2 },
          { "name": "priorityClassName", "value": "system-priority" },
          {
            "name": "deployment.podAntiAffinity.preferredDuringSchedulingIgnoredDuringExecution.0.weight",
            "value": 100
          },
          {
            "name": "deployment.podAntiAffinity.preferredDuringSchedulingIgnoredDuringExecution.0.podAffinityTerm.labelSelector.matchExpressions.0.key",
            "value": "app.kubernetes.io/name"
          },
          {
            "name": "deployment.podAntiAffinity.preferredDuringSchedulingIgnoredDuringExecution.0.podAffinityTerm.labelSelector.matchExpressions.0.operator",
            "value": "In"
          },
          {
            "name": "deployment.podAntiAffinity.preferredDuringSchedulingIgnoredDuringExecution.0.podAffinityTerm.labelSelector.matchExpressions.0.values.0",
            "value": "traefik"
          },
          {
            "name": "deployment.podAntiAffinity.preferredDuringSchedulingIgnoredDuringExecution.0.podAffinityTerm.topologyKey",
            "value": "kubernetes.io/hostname"
          }
        ],
        "values": ["${jsonencode(local.traefik-values)}"],
        "version": "34.0.0"
      }
    },
    "kubernetes_limit_range_v1": {
      "dev": {
        "metadata": {
          "name": "limit-dev",
          "namespace": "${kubernetes_namespace_v1.dev.metadata.0.name}"
        },
        "spec": {
          "limit": [
            {
              "default": { "cpu": "300m", "memory": "512Mi" },
              "default_request": { "cpu": "50m", "memory": "128Mi" },
              "type": "Container"
            }
          ]
        }
      },
      "main": {
        "metadata": {
          "name": "limit-main",
          "namespace": "${kubernetes_namespace_v1.main.metadata.0.name}"
        },
        "spec": {
          "limit": [
            {
              "default": { "cpu": "1500m", "memory": "3Gi" },
              "default_request": { "cpu": "100m", "memory": "512Mi" },
              "type": "Container"
            }
          ]
        }
      },
      "system": {
        "metadata": {
          "name": "limit-system",
          "namespace": "${kubernetes_namespace_v1.system.metadata.0.name}"
        },
        "spec": {
          "limit": [
            {
              "default": { "cpu": "1000m", "memory": "3Gi" },
              "default_request": { "cpu": "100m", "memory": "128Mi" },
              "type": "Container"
            }
          ]
        }
      }
    },
    "kubernetes_namespace_v1": {
      "dev": { "metadata": { "name": "dev" } },
      "main": { "metadata": { "name": "main" } },
      "system": { "metadata": { "name": "system" } }
    },
    "kubernetes_priority_class_v1": {
      "dev": { "metadata": { "name": "priority-dev" }, "value": 1 },
      "main": { "metadata": { "name": "priority-main" }, "value": 10 },
      "system": { "metadata": { "name": "priority-system" }, "value": 100 }
    },
    "kubernetes_resource_quota_v1": {
      "dev": {
        "metadata": {
          "name": "quota-dev",
          "namespace": "${kubernetes_namespace_v1.dev.metadata.0.name}"
        },
        "spec": {
          "hard": {
            "limits.cpu": "1000m",
            "limits.memory": "2Gi",
            "requests.cpu": "600m",
            "requests.memory": "1.5Gi"
          }
        }
      },
      "main": {
        "metadata": {
          "name": "quota-main",
          "namespace": "${kubernetes_namespace_v1.main.metadata.0.name}"
        },
        "spec": {
          "hard": {
            "limits.cpu": "8000m",
            "limits.memory": "20Gi",
            "requests.cpu": "5000m",
            "requests.memory": "13Gi"
          }
        }
      },
      "system": {
        "metadata": {
          "name": "quota-system",
          "namespace": "${kubernetes_namespace_v1.system.metadata.0.name}"
        },
        "spec": {
          "hard": {
            "limits.cpu": "3000m",
            "limits.memory": "8Gi",
            "requests.cpu": "1500m",
            "requests.memory": "5Gi"
          }
        }
      }
    }
  }
}

{
  "resource": {
    "helm_release": {
      "controller": {
        "chart": "traefik",
        "name": "controller",
        "namespace": "${kubernetes_namespace_v1.system.metadata.0.name}",
        "repository": "https://traefik.github.io/charts",
        "values": ["${jsonencode(local.controller-values)}"]
      },
      "monitor": {
        "chart": "kube-prometheus-stack",
        "name": "monitor",
        "namespace": "${kubernetes_namespace_v1.system.metadata.0.name}",
        "repository": "https://prometheus-community.github.io/helm-charts",
        "values": ["${jsonencode(local.monitor-values)}"]
      }
    },
    "kubernetes_limit_range_v1": {
      "dev": {
        "metadata": {
          "name": "limit-dev",
          "namespace": "${kubernetes_namespace_v1.dev.metadata.0.name}"
        },
        "spec": {
          "limit": [
            {
              "default": { "cpu": "200m", "memory": "512Mi" },
              "default_request": { "cpu": "50m", "memory": "128Mi" },
              "max": { "cpu": "300m", "memory": "512Mi" },
              "min": { "cpu": "10m", "memory": "64Mi" },
              "type": "Container"
            }
          ]
        }
      },
      "main": {
        "metadata": {
          "name": "limit-main",
          "namespace": "${kubernetes_namespace_v1.main.metadata.0.name}"
        },
        "spec": {
          "limit": [
            {
              "default": { "cpu": "800m", "memory": "3Gi" },
              "default_request": { "cpu": "250m", "memory": "1.5Gi" },
              "max": { "cpu": "2000m", "memory": "6Gi" },
              "type": "Container"
            }
          ]
        }
      },
      "system": {
        "metadata": {
          "name": "limit-system",
          "namespace": "${kubernetes_namespace_v1.system.metadata.0.name}"
        },
        "spec": {
          "limit": [
            {
              "default": { "cpu": "50m", "memory": "128Mi" },
              "default_request": { "cpu": "20m", "memory": "64Mi" },
              "type": "Container"
            }
          ]
        }
      }
    },
    "kubernetes_namespace_v1": {
      "dev": { "metadata": { "name": "dev" } },
      "main": { "metadata": { "name": "main" } },
      "system": { "metadata": { "name": "system" } }
    },
    "kubernetes_priority_class_v1": {
      "dev": { "metadata": { "name": "priority-dev" }, "value": 1 },
      "main": { "metadata": { "name": "priority-main" }, "value": 10 },
      "system": { "metadata": { "name": "priority-system" }, "value": 100 }
    },
    "kubernetes_resource_quota_v1": {
      "dev": {
        "metadata": {
          "name": "quota-dev",
          "namespace": "${kubernetes_namespace_v1.dev.metadata.0.name}"
        },
        "spec": {
          "hard": {
            "limits.cpu": "1000m",
            "limits.memory": "4Gi",
            "requests.cpu": "400m",
            "requests.memory": "2Gi"
          }
        }
      },
      "main": {
        "metadata": {
          "name": "quota-main",
          "namespace": "${kubernetes_namespace_v1.main.metadata.0.name}"
        },
        "spec": {
          "hard": {
            "limits.cpu": "4000m",
            "limits.memory": "14Gi",
            "requests.cpu": "1600m",
            "requests.memory": "8Gi"
          }
        }
      },
      "system": {
        "metadata": {
          "name": "quota-system",
          "namespace": "${kubernetes_namespace_v1.system.metadata.0.name}"
        },
        "spec": {
          "hard": {
            "limits.cpu": "2000m",
            "limits.memory": "6Gi",
            "requests.cpu": "1000m",
            "requests.memory": "4Gi"
          }
        }
      }
    }
  }
}

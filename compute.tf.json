{
  "resource": {
    "oci_containerengine_cluster": {
      "main": {
        "compartment_id": "${oci_identity_compartment.platform.id}",
        "endpoint_config": { "subnet_id": "${oci_core_subnet.private.id}" },
        "kubernetes_version": "${reverse(data.oci_containerengine_cluster_option.main.kubernetes_versions).0}",
        "name": "${local.project}-container-engine-cluster-main",
        "vcn_id": "${oci_core_vcn.main.id}"
      }
    },
    "oci_core_instance": {
      "bastion": {
        "agent_config": {
          "plugins_config": [
            { "desired_state": "DISABLED", "name": "Vulnerability Scanning" },
            { "desired_state": "DISABLED", "name": "Management Agent" },
            {
              "desired_state": "DISABLED",
              "name": "Compute Instance Monitoring"
            }
          ]
        },
        "availability_domain": "${data.oci_identity_availability_domains.main.availability_domains.0.name}",
        "compartment_id": "${oci_identity_compartment.platform.id}",
        "create_vnic_details": {
          "assign_public_ip": false,
          "display_name": "${local.project}-bastion-virtual-network-interface-card",
          "nsg_ids": [
            "${oci_core_network_security_group.bastion-to-global.id}"
          ],
          "subnet_id": "${oci_core_subnet.private.id}"
        },
        "display_name": "${local.project}-instance-bastion",
        "metadata": {
          "user_data": "${base64encode(join(\"\\n\", local.tailscale-user-data))}"
        },
        "shape": "VM.Standard.E2.1.Micro",
        "source_details": {
          "source_id": "${data.oci_core_images.ubuntu.images.0.id}",
          "source_type": "image"
        }
      }
    }
  }
}
